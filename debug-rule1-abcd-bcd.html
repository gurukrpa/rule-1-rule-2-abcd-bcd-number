<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Rule1 ABCD/BCD Numbers</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #fee2e2; border: 1px solid #fecaca; color: #991b1b; }
        .warning { background: #fef3c7; border: 1px solid #fde68a; color: #92400e; }
        .info { background: #dbeafe; border: 1px solid #bfdbfe; color: #1e40af; }
        .success { background: #dcfce7; border: 1px solid #bbf7d0; color: #166534; }
        .code { background: #1f2937; color: #f9fafb; padding: 15px; border-radius: 6px; font-family: 'Courier New', monospace; margin: 10px 0; overflow-x: auto; }
        .step { margin: 10px 0; padding: 10px; background: #f3f4f6; border-left: 4px solid #6b7280; }
        button { background: #3b82f6; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
        button:hover { background: #2563eb; }
        .log-container { background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px; padding: 15px; margin: 10px 0; max-height: 400px; overflow-y: auto; }
        .log-entry { margin: 2px 0; font-family: 'Courier New', monospace; font-size: 14px; }
        .log-error { color: #dc2626; }
        .log-warning { color: #d97706; }
        .log-info { color: #2563eb; }
        .log-success { color: #059669; }
        .debug-section { border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîç Rule1 Page ABCD/BCD Numbers Debugging</h1>
    
    <div class="info status">
        <strong>Purpose:</strong> Diagnose why ABCD/BCD numbers are not displaying on the Rule1 (Past Days) page.
    </div>

    <div class="debug-section">
        <h2>üéØ Quick Test Suite</h2>
        
        <div class="step">
            <strong>Step 1:</strong> Open Application and Navigate to Rule1 Page
            <button onclick="openApplication()">üì± Open http://localhost:5174</button>
            <div class="warning">
                Manual Steps:
                <ol>
                    <li>Select a user (e.g., demo-user-2025)</li>
                    <li>Ensure you have at least 5 dates with Excel and Hour Entry data</li>
                    <li>Click "Past Days" button on the 5th or later date</li>
                    <li>Check if ABCD/BCD numbers appear in the table headers and cells</li>
                </ol>
            </div>
        </div>

        <div class="step">
            <strong>Step 2:</strong> Check Browser Console for Rule1 Logs
            <button onclick="checkConsoleInstructions()">üìã Console Instructions</button>
            <div class="code" id="console-instructions" style="display: none;">
Open Browser Console (F12) and look for these key logs:

1. Rule1Page Data Loading:
   - "üîç [Rule1Page] Loading Rule-2 ABCD/BCD analysis results..."
   - "üìÖ [Rule1Page] Processing Past Days: [date] shows ABCD/BCD from [previous-date]"

2. Rule2 Analysis Service:
   - "üîß [Rule1Page] Calling rule2AnalysisService.performRule2Analysis"
   - "‚úÖ [Rule1Page] Real-time analysis SUCCESS for [date]"
   - "üìä ABCD Numbers: [numbers], BCD Numbers: [numbers]"

3. Topic-Specific Results:
   - "üîç [Rule1Page] Topic [topic-name] individual analysis"
   - "‚úÖ [Rule1Page] Successfully stored topic-specific ABCD/BCD data"

4. Display Rendering:
   - "üéØ [Rule1Page] MATCH FOUND! Element [number] in [topic] on [date]"
   - "‚úÖ [Rule1Page] Rendering ABCD/BCD tag for number [number]"

üö® ERROR INDICATORS:
   - "‚ùå [Rule1Page] Real-time analysis FAILED"
   - "‚ö†Ô∏è [Rule1Page] No dates available for Rule-2 analysis" 
   - "‚ùå [Rule1Page] Error in real-time analysis"
            </div>
        </div>

        <div class="step">
            <strong>Step 3:</strong> Test Data Integrity
            <button onclick="testDataIntegrity()">üîß Test Data</button>
            <div class="info">
                This will help verify if the issue is with data loading or ABCD/BCD calculation logic.
            </div>
        </div>
    </div>

    <div class="debug-section">
        <h2>üîç Common Issues & Solutions</h2>

        <div class="warning status">
            <strong>Issue 1: No ABCD/BCD Numbers in Headers</strong>
            <ul>
                <li><strong>Cause:</strong> abcdBcdAnalysis state is empty or not populated</li>
                <li><strong>Check:</strong> Look for "‚úÖ [Rule1Page] abcdBcdAnalysis state updated successfully" in console</li>
                <li><strong>Solution:</strong> Verify rule2AnalysisService is returning topic-specific results</li>
            </ul>
        </div>

        <div class="warning status">
            <strong>Issue 2: No ABCD/BCD Tags in Table Cells</strong>
            <ul>
                <li><strong>Cause:</strong> renderColorCodedDayNumber function not finding matches</li>
                <li><strong>Check:</strong> Look for "üéØ [Rule1Page] MATCH FOUND!" in console</li>
                <li><strong>Solution:</strong> Verify extractElementNumber is working correctly</li>
            </ul>
        </div>

        <div class="error status">
            <strong>Issue 3: Real-time Analysis Failing</strong>
            <ul>
                <li><strong>Cause:</strong> rule2AnalysisService.performRule2Analysis returning errors</li>
                <li><strong>Check:</strong> Look for "‚ùå [Rule1Page] Real-time analysis FAILED" in console</li>
                <li><strong>Solution:</strong> Check if sufficient dates and data exist for analysis</li>
            </ul>
        </div>

        <div class="info status">
            <strong>Issue 4: Missing Dependencies</strong>
            <ul>
                <li><strong>Cause:</strong> rule2AnalysisService import or initialization problems</li>
                <li><strong>Check:</strong> Verify import path in Rule1Page_Enhanced.jsx</li>
                <li><strong>Solution:</strong> Ensure service file exists and exports correctly</li>
            </ul>
        </div>
    </div>

    <div class="debug-section">
        <h2>üõ†Ô∏è Live Debugging Console</h2>
        <div class="log-container" id="debugLog">
            <div class="log-entry log-info">Debug console ready. Click "Start Debugging" to begin...</div>
        </div>
        <button onclick="startLiveDebugging()">üîÑ Start Live Debugging</button>
        <button onclick="clearDebugLog()">üóëÔ∏è Clear Log</button>
    </div>

    <div class="debug-section">
        <h2>üìã Expected vs Actual Behavior</h2>

        <div class="success status">
            <strong>Expected Behavior:</strong>
            <ul>
                <li>Rule1 page displays table with dates as columns and elements as rows</li>
                <li>Table headers show "ABCD: [numbers], BCD: [numbers]" for each date</li>
                <li>Table cells with matching numbers show green "ABCD" or blue "BCD" badges</li>
                <li>Pattern follows "(N-1)" logic - each date shows ABCD/BCD from previous date</li>
                <li>Console shows successful topic-specific analysis for each date</li>
            </ul>
        </div>

        <div class="error status">
            <strong>Current Problem:</strong>
            <ul>
                <li>ABCD/BCD numbers are NOT appearing in table headers</li>
                <li>ABCD/BCD badges are NOT appearing in table cells</li>
                <li>This suggests the abcdBcdAnalysis state is not being populated correctly</li>
            </ul>
        </div>
    </div>

    <div class="debug-section">
        <h2>üéØ Quick Fix Checklist</h2>
        
        <div class="step">
            <input type="checkbox" id="check1"> Rule1Page_Enhanced.jsx imports rule2AnalysisService correctly
        </div>
        <div class="step">
            <input type="checkbox" id="check2"> loadRule2AnalysisResults function is being called
        </div>
        <div class="step">
            <input type="checkbox" id="check3"> rule2AnalysisService.performRule2Analysis returns success=true
        </div>
        <div class="step">
            <input type="checkbox" id="check4"> Topic-specific results are being extracted from setResults
        </div>
        <div class="step">
            <input type="checkbox" id="check5"> abcdBcdAnalysis state is being updated with topic data
        </div>
        <div class="step">
            <input type="checkbox" id="check6"> renderColorCodedDayNumber function is finding matches
        </div>
        <div class="step">
            <input type="checkbox" id="check7"> Table headers display ABCD/BCD numbers from state
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const debugLog = document.getElementById('debugLog');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            debugLog.appendChild(entry);
            debugLog.scrollTop = debugLog.scrollHeight;
        }

        function openApplication() {
            window.open('http://localhost:5174/', '_blank');
            log('üöÄ Opened application in new tab', 'info');
            log('üìã Manual steps: Select user ‚Üí Ensure 5+ dates ‚Üí Click "Past Days"', 'warning');
        }

        function checkConsoleInstructions() {
            const instructions = document.getElementById('console-instructions');
            if (instructions.style.display === 'none') {
                instructions.style.display = 'block';
                log('üìã Console debugging instructions shown', 'info');
            } else {
                instructions.style.display = 'none';
                log('üìã Console debugging instructions hidden', 'info');
            }
        }

        function testDataIntegrity() {
            log('üîß Starting data integrity test...', 'info');
            log('üìä Check 1: Verify rule2AnalysisService is importable', 'info');
            log('üìä Check 2: Test performRule2Analysis with sample data', 'info');
            log('üìä Check 3: Verify topic-specific results extraction', 'info');
            log('‚ö†Ô∏è This requires manual verification in browser console', 'warning');
            
            // Show test script
            const testScript = `
// Test Script for Browser Console:
// 1. Open Rule1 page in application
// 2. Open browser console (F12)
// 3. Run this script to test data flow:

console.log('üîß Testing Rule1 ABCD/BCD Data Flow...');

// Check if rule2AnalysisService is available
if (window.rule2AnalysisService) {
    console.log('‚úÖ rule2AnalysisService is available');
} else {
    console.log('‚ùå rule2AnalysisService not found in window scope');
}

// Check abcdBcdAnalysis state (if Rule1Page is open)
setTimeout(() => {
    const abcdState = window.localStorage.getItem('rule1_abcd_analysis');
    if (abcdState) {
        console.log('üìä Found cached ABCD analysis:', JSON.parse(abcdState));
    } else {
        console.log('‚ö†Ô∏è No cached ABCD analysis found');
    }
}, 1000);
            `;
            
            log('üíª Test script generated - copy to browser console:', 'success');
            log(testScript, 'code');
        }

        function startLiveDebugging() {
            log('üîÑ Starting live debugging mode...', 'info');
            log('üìã Open Rule1 page and watch for debug messages', 'info');
            log('üîç Key things to monitor:', 'warning');
            log('  1. loadRule2AnalysisResults function execution', 'info');
            log('  2. rule2AnalysisService.performRule2Analysis calls', 'info');
            log('  3. Topic-specific results processing', 'info');
            log('  4. abcdBcdAnalysis state updates', 'info');
            log('  5. renderColorCodedDayNumber function calls', 'info');
            
            // Simulate monitoring (in real scenario, this would connect to app)
            let counter = 0;
            const monitor = setInterval(() => {
                counter++;
                if (counter <= 10) {
                    log(`üì° Monitoring... ${counter}/10`, 'info');
                } else {
                    clearInterval(monitor);
                    log('‚èπÔ∏è Monitoring completed. Check browser console for actual logs.', 'warning');
                }
            }, 1000);
        }

        function clearDebugLog() {
            const debugLog = document.getElementById('debugLog');
            debugLog.innerHTML = '<div class="log-entry log-info">Debug console cleared. Ready for new debugging session...</div>';
            log('üóëÔ∏è Debug log cleared', 'info');
        }

        // Auto-log on page load
        window.addEventListener('load', () => {
            log('üîç Rule1 ABCD/BCD Debug Console Initialized', 'success');
            log('üéØ Problem: ABCD/BCD numbers not displaying on Rule1 page', 'error');
            log('üí° Follow the steps above to diagnose the issue', 'info');
        });
    </script>
</body>
</html>
