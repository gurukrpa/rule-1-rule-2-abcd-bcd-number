<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N-1 Pattern Verification Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-link {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 5px;
            font-weight: bold;
        }
        .test-link:hover {
            background-color: #0056b3;
        }
        .test-link.july {
            background-color: #28a745;
        }
        .test-link.july:hover {
            background-color: #1e7e34;
        }
        .expected-result {
            background-color: #f8f9fa;
            border-left: 4px solid #17a2b8;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .instructions {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .date-pattern-explanation {
            background-color: #e7f3ff;
            border: 1px solid #b8daff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>🧪 N-1 Pattern Verification Test</h1>
    
    <div class="instructions">
        <h3>📋 Test Instructions</h3>
        <ol>
            <li>Click on any date link below to navigate to the Planets Analysis page</li>
            <li>Check the console logs and success message on the page</li>
            <li>Verify that the N-1 pattern is working correctly (clicking date X shows analysis for date X-1)</li>
            <li>Pay special attention to the debug logs showing date selection logic</li>
        </ol>
    </div>

    <div class="date-pattern-explanation">
        <h3>🎯 N-1 Pattern Expected Behavior</h3>
        <p><strong>The Rule:</strong> When you click on date <code>X</code>, the system should analyze data from date <code>X-1</code> (previous day).</p>
        <ul>
            <li><strong>Display Date:</strong> Shows the date you clicked (for user reference)</li>
            <li><strong>Analysis Date:</strong> Uses data from the previous day (N-1 pattern)</li>
            <li><strong>Fallback:</strong> If N-1 date is not available, falls back to latest available date</li>
        </ul>
    </div>

    <div class="test-container">
        <h2>🗓️ July 2025 Date Tests</h2>
        <p>Test the N-1 pattern with July 2025 dates. Click any date and verify the analysis uses the previous day's data.</p>
        
        <div class="expected-result">
            <strong>Expected for July 8th, 2025:</strong><br>
            • Display Date: July 8, 2025 (what user clicked)<br>
            • Analysis Date: July 7, 2025 (N-1 previous day)<br>
            • Message: "Analyzing 7/8/2025 using data from 7/7/2025 (N-1 pattern: Previous day's data)"
        </div>

        <a href="http://localhost:3000/planets-analysis/testuser123?date=2025-07-01" class="test-link july">July 1st, 2025</a>
        <a href="http://localhost:3000/planets-analysis/testuser123?date=2025-07-02" class="test-link july">July 2nd, 2025</a>
        <a href="http://localhost:3000/planets-analysis/testuser123?date=2025-07-03" class="test-link july">July 3rd, 2025</a>
        <a href="http://localhost:3000/planets-analysis/testuser123?date=2025-07-04" class="test-link july">July 4th, 2025</a>
        <a href="http://localhost:3000/planets-analysis/testuser123?date=2025-07-05" class="test-link july">July 5th, 2025</a>
        <a href="http://localhost:3000/planets-analysis/testuser123?date=2025-07-06" class="test-link july">July 6th, 2025</a>
        <a href="http://localhost:3000/planets-analysis/testuser123?date=2025-07-07" class="test-link july">July 7th, 2025</a>
        <a href="http://localhost:3000/planets-analysis/testuser123?date=2025-07-08" class="test-link july">🎯 July 8th, 2025 (Main Test)</a>
        <a href="http://localhost:3000/planets-analysis/testuser123?date=2025-07-09" class="test-link july">July 9th, 2025</a>
        <a href="http://localhost:3000/planets-analysis/testuser123?date=2025-07-10" class="test-link july">July 10th, 2025</a>
    </div>

    <div class="test-container">
        <h2>🗓️ June 2025 Date Tests</h2>
        <p>Test with June 2025 dates to verify the pattern works across different months.</p>
        
        <div class="expected-result">
            <strong>Expected for June 30th, 2025:</strong><br>
            • Display Date: June 30, 2025 (what user clicked)<br>
            • Analysis Date: June 29, 2025 (N-1 previous day)<br>
            • Message: "Analyzing 6/30/2025 using data from 6/29/2025 (N-1 pattern: Previous day's data)"
        </div>

        <a href="http://localhost:3000/planets-analysis/testuser123?date=2025-06-28" class="test-link">June 28th, 2025</a>
        <a href="http://localhost:3000/planets-analysis/testuser123?date=2025-06-29" class="test-link">June 29th, 2025</a>
        <a href="http://localhost:3000/planets-analysis/testuser123?date=2025-06-30" class="test-link">June 30th, 2025</a>
    </div>

    <div class="test-container">
        <h2>🔍 Debug Information to Check</h2>
        <p>When testing, look for these debug messages in the browser console:</p>
        <ul>
            <li><code>🔍 [PlanetsAnalysis] URL date extraction</code> - Shows URL parameter parsing</li>
            <li><code>🔍 [DEBUG] Date selection debug</code> - Shows the detailed date selection logic</li>
            <li><code>✅ Using N-1 pattern</code> - Confirms N-1 pattern is being applied</li>
            <li><code>Display date (user clicked)</code> - Shows what user clicked</li>
            <li><code>Analysis date (N-1)</code> - Shows what date is being used for analysis</li>
            <li><code>N-1 date available in data</code> - Confirms if the previous day's data exists</li>
        </ul>
    </div>

    <div class="test-container">
        <h2>✅ Success Criteria</h2>
        <p>The test passes if:</p>
        <ol>
            <li>Clicking "July 8th, 2025" shows a success message mentioning July 7th, 2025 as the analysis date</li>
            <li>Console logs show "Analysis date (N-1): 2025-07-07"</li>
            <li>The page displays analysis results from July 7th data, not June 30th</li>
            <li>The user interface clearly indicates which date was clicked vs which date's data is being analyzed</li>
        </ol>
    </div>

    <script>
        // Add some JavaScript to help with testing
        console.log('🧪 N-1 Pattern Test Page Loaded');
        console.log('📅 Current Date:', new Date().toLocaleDateString());
        console.log('🎯 Test Objective: Verify N-1 pattern (click date X → analyze date X-1)');
        
        // Add click handlers to log which link was clicked
        document.querySelectorAll('.test-link').forEach(link => {
            link.addEventListener('click', function(e) {
                const clickedDate = this.textContent;
                const url = this.href;
                console.log(`🖱️ Clicked: ${clickedDate}`);
                console.log(`🔗 URL: ${url}`);
                console.log(`📊 Expected: Should analyze previous day's data`);
            });
        });
    </script>
</body>
</html>
