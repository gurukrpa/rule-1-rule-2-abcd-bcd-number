<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ketu Data Live Debugger</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .log { margin: 10px 0; padding: 10px; background: #2a2a2a; border-radius: 5px; }
        .success { border-left: 4px solid #4ade80; }
        .error { border-left: 4px solid #ef4444; }
        .warning { border-left: 4px solid #f59e0b; }
        .info { border-left: 4px solid #3b82f6; }
        button { padding: 10px 20px; margin: 10px 5px; background: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #2563eb; }
        input[type="file"] { margin: 10px 0; }
        pre { background: #1a1a1a; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Ketu Data Live Debugger for UserData Page</h1>
    
    <div class="log info">
        <h3>üìã Instructions:</h3>
        <ol>
            <li>Open UserData page in another tab: <a href="http://localhost:3000" target="_blank">http://localhost:3000</a></li>
            <li>Open browser console (F12 ‚Üí Console) on UserData page</li>
            <li>Upload Excel file on UserData page</li>
            <li>Use this page to monitor what's happening</li>
        </ol>
    </div>

    <div class="log info">
        <h3>üß™ Test Excel File Simulator:</h3>
        <input type="file" id="excelFile" accept=".xlsx,.xls" />
        <button onclick="simulateExcelUpload()">Simulate Excel Processing</button>
        <button onclick="testKetuData()">Test Ketu Data Structure</button>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>

    <div id="logs"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            logsDiv.appendChild(logDiv);
            console.log(`[Debug] ${message}`);
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        // Test Ketu data structure
        function testKetuData() {
            log('üß™ Testing Ketu data structure...', 'info');
            
            const testExcelData = {
                'Lg': { 'D1': 'Ar', 'D2': 'Ta', 'D3': 'Ge' },
                'Su': { 'D1': 'Le', 'D2': 'Vi', 'D3': 'Li' },
                'Mo': { 'D1': 'Sc', 'D2': 'Sa', 'D3': 'Cp' },
                'Ma': { 'D1': 'Aq', 'D2': 'Pi', 'D3': 'Ar' },
                'Me': { 'D1': 'Ta', 'D2': 'Ge', 'D3': 'Ca' },
                'Ju': { 'D1': 'Le', 'D2': 'Vi', 'D3': 'Li' },
                'Ve': { 'D1': 'Sc', 'D2': 'Sa', 'D3': 'Cp' },
                'Sa': { 'D1': 'Aq', 'D2': 'Pi', 'D3': 'Ar' },
                'Ra': { 'D1': 'Ta', 'D2': 'Ge', 'D3': 'Ca' },
                'Ke': { 'D1': 'Sc', 'D2': 'Sa', 'D3': 'Cp', 'D4': 'Aq', 'D5': 'Pi' }
            };

            log('‚úÖ Created test Excel data structure', 'success');
            log(`‚úÖ Total planets: ${Object.keys(testExcelData).length}`, 'success');
            log(`‚úÖ Ketu data exists: ${!!testExcelData.Ke}`, 'success');
            log(`‚úÖ Ketu divisions: ${Object.keys(testExcelData.Ke).join(', ')}`, 'success');
            
            // Test planet selection simulation
            const selectedPlanet = 'Ke';
            log(`üîç Simulating planet selection: "${selectedPlanet}"`, 'info');
            
            if (testExcelData[selectedPlanet]) {
                log(`‚úÖ Planet data found for "${selectedPlanet}"`, 'success');
                log(`‚úÖ Available divisions: ${Object.keys(testExcelData[selectedPlanet]).join(', ')}`, 'success');
                
                Object.entries(testExcelData[selectedPlanet]).forEach(([division, house]) => {
                    log(`  üìã ${division}: "${house}"`, 'success');
                });
            } else {
                log(`‚ùå No planet data found for "${selectedPlanet}"`, 'error');
            }

            // Copy to window for console access
            window.testExcelData = testExcelData;
            log('‚úÖ Test data available in console as: window.testExcelData', 'info');
        }

        // Simulate Excel upload processing
        function simulateExcelUpload() {
            const fileInput = document.getElementById('excelFile');
            const file = fileInput.files[0];
            
            if (!file) {
                log('‚ùå Please select an Excel file first', 'error');
                return;
            }

            log(`üîç Processing Excel file: ${file.name}`, 'info');
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const range = XLSX.utils.decode_range(worksheet['!ref']);
                    
                    log(`‚úÖ Excel file loaded successfully`, 'success');
                    log(`‚úÖ Sheet range: ${worksheet['!ref']}`, 'success');
                    
                    // Check for planets in the Excel
                    log('üîç Scanning for planets in Excel...', 'info');
                    
                    const viboothiPlanetMapping = {
                        'Lagna': 'Lg', 'Sun': 'Su', 'Moon': 'Mo', 'Mars': 'Ma',
                        'Mercury': 'Me', 'Jupiter': 'Ju', 'Venus': 'Ve', 'Saturn': 'Sa',
                        'Rahu': 'Ra', 'Ketu': 'Ke', 'Kethu': 'Ke', 'KETU': 'Ke',
                        'KETHU': 'Ke', 'ketu': 'Ke', 'kethu': 'Ke'
                    };
                    
                    let ketuFound = false;
                    const foundPlanets = [];
                    
                    // Scan planet column (column A, starting from row 2)
                    for (let row = 2; row <= Math.min(10, range.e.r); row++) {
                        const planetCell = worksheet[XLSX.utils.encode_cell({ r: row, c: 0 })];
                        if (planetCell && planetCell.v) {
                            const planetName = planetCell.v.toString().trim();
                            foundPlanets.push(planetName);
                            
                            if (viboothiPlanetMapping[planetName]) {
                                log(`‚úÖ Found planet: "${planetName}" ‚Üí ${viboothiPlanetMapping[planetName]}`, 'success');
                                
                                if (viboothiPlanetMapping[planetName] === 'Ke') {
                                    ketuFound = true;
                                    log(`üéØ KETU FOUND! Row ${row + 1}, Name: "${planetName}"`, 'success');
                                }
                            } else {
                                log(`‚ö†Ô∏è Unknown planet: "${planetName}"`, 'warning');
                            }
                        }
                    }
                    
                    if (ketuFound) {
                        log('‚úÖ KETU DETECTION: SUCCESS', 'success');
                    } else {
                        log('‚ùå KETU DETECTION: FAILED', 'error');
                        log(`‚ùå Found planets: ${foundPlanets.join(', ')}`, 'error');
                        log(`‚ùå Expected Ketu variations: ${Object.keys(viboothiPlanetMapping).filter(k => viboothiPlanetMapping[k] === 'Ke').join(', ')}`, 'error');
                    }
                    
                } catch (error) {
                    log(`‚ùå Excel processing error: ${error.message}`, 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        // Auto-load test data
        document.addEventListener('DOMContentLoaded', () => {
            log('üöÄ Ketu Live Debugger initialized', 'info');
            log('üì± Ready to help debug Ketu data fetching issues', 'info');
        });

        // Monitor console activity
        const originalConsoleLog = console.log;
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            
            const message = args.join(' ');
            if (message.includes('Ketu') || message.includes('Ke') || message.includes('[UserData]') || message.includes('[ExcelUpload]')) {
                if (message.includes('‚ùå') || message.includes('ERROR')) {
                    log(`üîç Console: ${message}`, 'error');
                } else if (message.includes('‚úÖ')) {
                    log(`üîç Console: ${message}`, 'success');
                } else {
                    log(`üîç Console: ${message}`, 'info');
                }
            }
        };
    </script>
</body>
</html>
