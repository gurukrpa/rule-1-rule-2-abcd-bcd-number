<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç D-1 Set-1 HR Analysis Debug Tool</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            background: #0a0a0a; 
            color: #00ff00; 
            padding: 20px; 
            line-height: 1.4; 
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #333; 
            border-radius: 8px; 
            background: #111;
        }
        .header { 
            background: #1a1a2e; 
            border-color: #16213e;
            color: #eee;
            text-align: center;
        }
        .success { background: #0d4427; border-color: #4caf50; }
        .error { background: #4a1a1a; border-color: #f44336; }
        .warning { background: #4a4a1a; border-color: #ff9800; }
        .info { background: #1a2a4a; border-color: #2196f3; }
        
        .hr-box { 
            display: inline-block; 
            margin: 10px; 
            padding: 15px; 
            border: 2px solid #555; 
            border-radius: 6px; 
            background: #222; 
            min-width: 200px;
            text-align: center;
        }
        .hr-box.active { border-color: #00ff00; background: #002200; }
        .hr-box.error { border-color: #ff0000; background: #220000; }
        
        .numbers { 
            font-weight: bold; 
            color: #ffff00; 
            margin: 5px 0;
        }
        .abcd { color: #4caf50; }
        .bcd { color: #2196f3; }
        
        pre { 
            background: #000; 
            padding: 10px; 
            border-radius: 4px; 
            border-left: 4px solid #00ff00;
            overflow-x: auto;
            font-size: 12px;
        }
        
        button { 
            background: #4caf50; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 5px;
            font-weight: bold;
        }
        button:hover { background: #45a049; }
        button.secondary { background: #2196f3; }
        button.secondary:hover { background: #1976d2; }
        
        .step { 
            margin: 15px 0; 
            padding: 10px; 
            background: #333; 
            border-left: 4px solid #00bcd4; 
            border-radius: 4px;
        }
        
        .highlight { background: #444; padding: 2px 6px; border-radius: 3px; color: #ffff00; }
        .critical { color: #ff5722; font-weight: bold; }
        .good { color: #4caf50; font-weight: bold; }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="section header">
            <h1>üîç D-1 Set-1 Matrix HR Analysis Debug Tool</h1>
            <p>Verify ABCD/BCD number fetching for each HR period</p>
        </div>

        <div class="section info">
            <h2>üìã Test Instructions</h2>
            <div class="step">
                <h3>Step 1: Setup</h3>
                <p>1. Open <span class="highlight">http://localhost:5173</span> in another tab</p>
                <p>2. Navigate to any user with complete data</p>
                <p>3. Select a date that's 5th or later chronologically</p>
                <p>4. Click <span class="highlight">"Rule-2"</span> button</p>
            </div>
            
            <div class="step">
                <h3>Step 2: Monitor Console</h3>
                <p>Open Developer Tools (F12) ‚Üí Console tab</p>
                <p>Look for messages containing:</p>
                <pre>üéØ [Rule2CompactPage] Processing D-1 Set-1 Matrix for HR [X]
üìä [ABCD Analysis] D-1 Set-1 Matrix HR [X]: ABCD [numbers] / BCD [numbers]</pre>
            </div>
            
            <div class="step">
                <h3>Step 3: Use This Debug Tool</h3>
                <p>Copy the console output into the analysis box below</p>
                <button onclick="startManualTest()">üöÄ Start Manual Test</button>
                <button onclick="showExpectedOutput()" class="secondary">üìã Show Expected Output</button>
            </div>
        </div>

        <div class="section warning">
            <h2>üîç Expected D-1 Set-1 Matrix Results by HR</h2>
            <p><strong>This tool will help verify that each HR period correctly extracts different ABCD/BCD numbers for D-1 Set-1 Matrix.</strong></p>
            
            <div class="results-grid">
                <div class="hr-box" id="hr1">
                    <h3>HR-1</h3>
                    <div class="numbers abcd">ABCD: <span id="hr1-abcd">[ ? ]</span></div>
                    <div class="numbers bcd">BCD: <span id="hr1-bcd">[ ? ]</span></div>
                    <div class="status">Status: <span id="hr1-status">Waiting...</span></div>
                </div>
                
                <div class="hr-box" id="hr2">
                    <h3>HR-2</h3>
                    <div class="numbers abcd">ABCD: <span id="hr2-abcd">[ ? ]</span></div>
                    <div class="numbers bcd">BCD: <span id="hr2-bcd">[ ? ]</span></div>
                    <div class="status">Status: <span id="hr2-status">Waiting...</span></div>
                </div>
                
                <div class="hr-box" id="hr3">
                    <h3>HR-3</h3>
                    <div class="numbers abcd">ABCD: <span id="hr3-abcd">[ ? ]</span></div>
                    <div class="numbers bcd">BCD: <span id="hr3-bcd">[ ? ]</span></div>
                    <div class="status">Status: <span id="hr3-status">Waiting...</span></div>
                </div>
                
                <div class="hr-box" id="hr4">
                    <h3>HR-4</h3>
                    <div class="numbers abcd">ABCD: <span id="hr4-abcd">[ ? ]</span></div>
                    <div class="numbers bcd">BCD: <span id="hr4-bcd">[ ? ]</span></div>
                    <div class="status">Status: <span id="hr4-status">Waiting...</span></div>
                </div>
                
                <div class="hr-box" id="hr5">
                    <h3>HR-5</h3>
                    <div class="numbers abcd">ABCD: <span id="hr5-abcd">[ ? ]</span></div>
                    <div class="numbers bcd">BCD: <span id="hr5-bcd">[ ? ]</span></div>
                    <div class="status">Status: <span id="hr5-status">Waiting...</span></div>
                </div>
                
                <div class="hr-box" id="hr6">
                    <h3>HR-6</h3>
                    <div class="numbers abcd">ABCD: <span id="hr6-abcd">[ ? ]</span></div>
                    <div class="numbers bcd">BCD: <span id="hr6-bcd">[ ? ]</span></div>
                    <div class="status">Status: <span id="hr6-status">Waiting...</span></div>
                </div>
            </div>
        </div>

        <div class="section info">
            <h2>üõ†Ô∏è Manual Analysis Input</h2>
            <p>Paste console output from Rule-2 page here to analyze:</p>
            <textarea id="consoleInput" rows="10" style="width: 100%; background: #000; color: #00ff00; border: 1px solid #333; padding: 10px; font-family: monospace;">
Paste console logs here...

Example expected format:
üéØ [Rule2CompactPage] Processing D-1 Set-1 Matrix for HR 1
üìä D-day numbers for 2025-01-05, set D-1 Set-1 Matrix: [1,2,4,7,9]
üìä ABCD Analysis: D-1 Set-1 Matrix HR 1: ABCD [1,2,4,7,9] / BCD [5]
            </textarea>
            <br>
            <button onclick="analyzeConsoleOutput()">üîç Analyze Output</button>
            <button onclick="clearResults()" class="secondary">üóëÔ∏è Clear Results</button>
        </div>

        <div class="section success" id="resultsSection" style="display: none;">
            <h2>‚úÖ Analysis Results</h2>
            <div id="analysisResults"></div>
        </div>

        <div class="section error" id="issuesSection" style="display: none;">
            <h2>‚ùå Issues Found</h2>
            <div id="issuesResults"></div>
        </div>

        <div class="section warning">
            <h2>üéØ What We're Looking For</h2>
            
            <h3>‚úÖ Correct Behavior:</h3>
            <ul>
                <li><strong>Different numbers per HR:</strong> Each HR (1-6) should show different ABCD/BCD numbers</li>
                <li><strong>Consistent extraction:</strong> Same HR should always produce same numbers for D-1 Set-1</li>
                <li><strong>Valid numbers:</strong> ABCD and BCD arrays should contain positive integers 1-12</li>
                <li><strong>No overlaps:</strong> Numbers cannot appear in both ABCD and BCD for same HR</li>
            </ul>
            
            <h3>‚ùå Problems to Identify:</h3>
            <ul>
                <li><strong>Same numbers:</strong> All HRs showing identical ABCD/BCD numbers</li>
                <li><strong>Empty results:</strong> HR showing no ABCD or BCD numbers</li>
                <li><strong>Extraction failures:</strong> Console errors during number extraction</li>
                <li><strong>Missing data:</strong> D-1 Set-1 Matrix not found in data</li>
            </ul>
        </div>

        <div class="section info">
            <h2>üìö Debug Commands</h2>
            <p>Run these in the main application console for detailed debugging:</p>
            
            <h3>Check D-1 Set-1 Availability:</h3>
            <pre>// Check if D-1 Set-1 Matrix exists in current data
console.log('Available sets:', Object.keys(window.debugData?.sets || {}));
console.log('D-1 Set-1 found:', !!window.debugData?.sets?.['D-1 Set-1 Matrix']);</pre>
            
            <h3>Manual HR Analysis:</h3>
            <pre>// Manually test HR extraction for D-1 Set-1
for(let hr = 1; hr <= 6; hr++) {
  console.log(`Testing HR ${hr} for D-1 Set-1 Matrix`);
  // Results will show in console
}</pre>
            
            <button onclick="copyDebugCommands()">üìã Copy Debug Commands</button>
        </div>
    </div>

    <script>
        function startManualTest() {
            alert(`üöÄ Manual Test Steps:

1. Open http://localhost:5173 in new tab
2. Navigate: User ‚Üí Date ‚Üí Rule-2
3. Monitor console for D-1 Set-1 messages
4. Copy all console output
5. Paste it in the analysis box below
6. Click "Analyze Output"

Look for messages containing:
- "Processing D-1 Set-1 Matrix"
- "ABCD Analysis: D-1 Set-1 Matrix HR"
- Numbers in format: ABCD [x,y,z] / BCD [a,b]`);
            
            window.open('http://localhost:5173', '_blank');
        }

        function showExpectedOutput() {
            document.getElementById('consoleInput').value = `üéØ [Rule2CompactPage] Processing D-1 Set-1 Matrix for HR 1
üìä D-day numbers for 2025-01-05, set D-1 Set-1 Matrix: [1,2,4,7,9]
üìä ABCD Analysis: D-1 Set-1 Matrix HR 1: ABCD [1,2,4,7,9] / BCD [5]

üéØ [Rule2CompactPage] Processing D-1 Set-1 Matrix for HR 2  
üìä D-day numbers for 2025-01-05, set D-1 Set-1 Matrix: [3,6,8,11,12]
üìä ABCD Analysis: D-1 Set-1 Matrix HR 2: ABCD [3,6,8] / BCD [11,12]

üéØ [Rule2CompactPage] Processing D-1 Set-1 Matrix for HR 3
üìä D-day numbers for 2025-01-05, set D-1 Set-1 Matrix: [2,5,7,10]
üìä ABCD Analysis: D-1 Set-1 Matrix HR 3: ABCD [2,5] / BCD [7,10]

--- Continue for HR 4, 5, 6 ---`;
        }

        function analyzeConsoleOutput() {
            const input = document.getElementById('consoleInput').value;
            const lines = input.split('\n').filter(line => line.trim());
            
            const hrResults = {};
            let currentHR = null;
            
            // Parse console output
            lines.forEach(line => {
                // Look for HR processing messages
                const hrMatch = line.match(/Processing D-1 Set-1 Matrix for HR (\d+)/);
                if (hrMatch) {
                    currentHR = parseInt(hrMatch[1]);
                    if (!hrResults[currentHR]) {
                        hrResults[currentHR] = { found: true };
                    }
                }
                
                // Look for ABCD analysis results
                const analysisMatch = line.match(/ABCD Analysis: D-1 Set-1 Matrix HR (\d+): ABCD \[(.*?)\] \/ BCD \[(.*?)\]/);
                if (analysisMatch) {
                    const hr = parseInt(analysisMatch[1]);
                    const abcdStr = analysisMatch[2].trim();
                    const bcdStr = analysisMatch[3].trim();
                    
                    hrResults[hr] = {
                        found: true,
                        abcd: abcdStr ? abcdStr.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n)) : [],
                        bcd: bcdStr ? bcdStr.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n)) : []
                    };
                }
            });
            
            // Update UI
            updateHRBoxes(hrResults);
            analyzeResults(hrResults);
        }

        function updateHRBoxes(hrResults) {
            for (let hr = 1; hr <= 6; hr++) {
                const box = document.getElementById(`hr${hr}`);
                const result = hrResults[hr];
                
                if (result && result.found) {
                    box.className = 'hr-box active';
                    document.getElementById(`hr${hr}-abcd`).textContent = result.abcd ? `[${result.abcd.join(', ')}]` : '[ No data ]';
                    document.getElementById(`hr${hr}-bcd`).textContent = result.bcd ? `[${result.bcd.join(', ')}]` : '[ No data ]';
                    document.getElementById(`hr${hr}-status`).textContent = '‚úÖ Found';
                } else {
                    box.className = 'hr-box error';
                    document.getElementById(`hr${hr}-abcd`).textContent = '[ Missing ]';
                    document.getElementById(`hr${hr}-bcd`).textContent = '[ Missing ]';
                    document.getElementById(`hr${hr}-status`).textContent = '‚ùå Not found';
                }
            }
        }

        function analyzeResults(hrResults) {
            const resultsDiv = document.getElementById('analysisResults');
            const issuesDiv = document.getElementById('issuesResults');
            
            let analysis = '';
            let issues = '';
            let hasIssues = false;
            
            // Check if we have any results
            const foundHRs = Object.keys(hrResults).filter(hr => hrResults[hr].found);
            
            if (foundHRs.length === 0) {
                issues += '<p class="critical">‚ùå No D-1 Set-1 Matrix data found in console output!</p>';
                issues += '<p>Make sure to:</p><ul><li>Navigate to Rule-2 page</li><li>Wait for analysis to complete</li><li>Copy ALL console messages</li></ul>';
                hasIssues = true;
            } else {
                analysis += `<p class="good">‚úÖ Found D-1 Set-1 Matrix data for ${foundHRs.length}/6 HR periods</p>`;
                
                // Check for diversity in numbers
                const allABCD = [];
                const allBCD = [];
                foundHRs.forEach(hr => {
                    if (hrResults[hr].abcd) allABCD.push(...hrResults[hr].abcd);
                    if (hrResults[hr].bcd) allBCD.push(...hrResults[hr].bcd);
                });
                
                const uniqueABCD = [...new Set(allABCD)];
                const uniqueBCD = [...new Set(allBCD)];
                
                analysis += `<p>üìä Total unique ABCD numbers across all HRs: ${uniqueABCD.length}</p>`;
                analysis += `<p>üìä Total unique BCD numbers across all HRs: ${uniqueBCD.length}</p>`;
                
                // Check for potential issues
                if (uniqueABCD.length < foundHRs.length) {
                    issues += '<p class="critical">‚ö†Ô∏è Same ABCD numbers appearing in multiple HRs - this may indicate extraction issues</p>';
                    hasIssues = true;
                }
                
                // Check for missing HRs
                for (let hr = 1; hr <= 6; hr++) {
                    if (!hrResults[hr] || !hrResults[hr].found) {
                        issues += `<p>‚ö†Ô∏è HR ${hr}: No data found</p>`;
                        hasIssues = true;
                    }
                }
                
                // Detailed breakdown
                analysis += '<h3>üìã Detailed Breakdown:</h3><ul>';
                foundHRs.forEach(hr => {
                    const result = hrResults[hr];
                    analysis += `<li><strong>HR ${hr}:</strong> ABCD[${result.abcd ? result.abcd.join(', ') : 'none'}] BCD[${result.bcd ? result.bcd.join(', ') : 'none'}]</li>`;
                });
                analysis += '</ul>';
            }
            
            resultsDiv.innerHTML = analysis;
            document.getElementById('resultsSection').style.display = 'block';
            
            if (hasIssues) {
                issuesDiv.innerHTML = issues;
                document.getElementById('issuesSection').style.display = 'block';
            } else {
                document.getElementById('issuesSection').style.display = 'none';
            }
        }

        function clearResults() {
            document.getElementById('consoleInput').value = 'Paste console logs here...';
            
            for (let hr = 1; hr <= 6; hr++) {
                const box = document.getElementById(`hr${hr}`);
                box.className = 'hr-box';
                document.getElementById(`hr${hr}-abcd`).textContent = '[ ? ]';
                document.getElementById(`hr${hr}-bcd`).textContent = '[ ? ]';
                document.getElementById(`hr${hr}-status`).textContent = 'Waiting...';
            }
            
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('issuesSection').style.display = 'none';
        }

        function copyDebugCommands() {
            const commands = `// Debug commands for Rule-2 ABCD/BCD analysis
console.log('=== D-1 Set-1 Matrix Debug ===');

// Check available sets
if (window.debugData?.sets) {
    console.log('üìä Available sets:', Object.keys(window.debugData.sets));
    console.log('‚úÖ D-1 Set-1 found:', !!window.debugData.sets['D-1 Set-1 Matrix']);
} else {
    console.log('‚ùå No debugData.sets available');
}

// Check HR planet selections
console.log('ü™ê HR planet selections:', window.debugData?.planetSelections || 'Not available');

// Manual HR test for D-1 Set-1
for(let hr = 1; hr <= 6; hr++) {
    console.log(\`üîç Testing HR \${hr} for D-1 Set-1 Matrix\`);
    // Add specific extraction test here
}`;

            navigator.clipboard.writeText(commands);
            alert('üìã Debug commands copied to clipboard!\n\nPaste them in the main application console to run detailed debugging.');
        }

        // Auto-highlight when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîç D-1 Set-1 HR Analysis Debug Tool loaded');
            console.log('üëÜ Use the buttons above to start testing');
        });
    </script>
</body>
</html>
