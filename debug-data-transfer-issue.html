<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔍 Rule-2 → Planets Analysis Data Transfer Debug</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            background: #1a1a1a; 
            color: #e0e0e0; 
            padding: 20px; 
            line-height: 1.6; 
        }
        .section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #444; 
            border-radius: 8px; 
            background: #2a2a2a;
        }
        .success { background: #1a4a1a; border-color: #4caf50; }
        .error { background: #4a1a1a; border-color: #f44336; }
        .warning { background: #4a4a1a; border-color: #ff9800; }
        .info { background: #1a2a4a; border-color: #2196f3; }
        pre { 
            background: #0f0f0f; 
            padding: 15px; 
            border-radius: 5px; 
            overflow-x: auto; 
            border-left: 4px solid #00ff00;
            font-size: 12px;
        }
        .highlight { background: #444; padding: 2px 4px; border-radius: 3px; }
        .step { 
            background: #333; 
            padding: 10px; 
            margin: 10px 0; 
            border-left: 4px solid #00bcd4; 
            border-radius: 4px;
        }
        button { 
            background: #4caf50; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 5px;
            font-weight: bold;
        }
        button:hover { background: #45a049; }
        .critical { color: #ff5722; font-weight: bold; }
        .good { color: #4caf50; font-weight: bold; }
        .data-box { 
            background: #000; 
            border: 2px solid #00ff00; 
            padding: 10px; 
            margin: 10px 0; 
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <h1>🔍 Debug: Rule-2 → Planets Analysis Data Transfer Issue</h1>
    
    <div class="section error">
        <h2>🚨 IDENTIFIED ISSUE</h2>
        <p><strong>Problem:</strong> Rule-2 shows "1,2,4,7,9/5" but Planets Analysis shows "1,3/7"</p>
        <p><strong>Suspected Cause:</strong> Data corruption during URL parameter transfer or parsing</p>
        <div class="data-box">
            <strong>Expected Flow:</strong><br>
            Rule-2 Analysis → Prepare Data → URL Encode → Navigate → URL Decode → Display
        </div>
    </div>

    <div class="section info">
        <h2>📋 Step-by-Step Debug Instructions</h2>
        
        <div class="step">
            <h3>Step 1: Navigate to Application</h3>
            <p>1. Open <a href="http://localhost:5173" target="_blank">localhost:5173</a></p>
            <p>2. Select a user with data</p>
            <p>3. Click on a date that's 5th or later chronologically</p>
            <p>4. Click the <span class="highlight">"Rule-2"</span> button</p>
        </div>

        <div class="step">
            <h3>Step 2: Examine Rule-2 Display</h3>
            <p>Look for the section: <span class="highlight">"📋 ABCD/BCD Numbers below for Next Day"</span></p>
            <div class="data-box">
                Expected Format:<br>
                01. D-1 Set-1 Matrix -ABCD Numbers- <span class="good">1,2,4,7,9</span> / BCD Numbers- <span class="good">5</span>
            </div>
            <p>📝 <strong>Record these numbers exactly</strong></p>
        </div>

        <div class="step">
            <h3>Step 3: Monitor Console Logs (Rule-2 → Planets)</h3>
            <p>Open Developer Tools (F12) → Console Tab</p>
            <p>Click the <span class="highlight">"🪐 Planets Analysis"</span> button</p>
            <p><strong>Look for these specific logs:</strong></p>
            <pre>🎯 [Rule2→Planets D-1 Set-1] Key: "D-1 Set-1 Matrix"
🎯 [Rule2→Planets D-1 Set-1] Data: {abcd: [1,2,4,7,9], bcd: [5]}
🎯 [Rule2→Planets D-1 Set-1] ABCD: [1, 2, 4, 7, 9]
🎯 [Rule2→Planets D-1 Set-1] BCD: [5]</pre>
        </div>

        <div class="step">
            <h3>Step 4: Check URL Parameter Encoding</h3>
            <p>Look for these console logs:</p>
            <pre>🌐 [Rule2→Planets] Navigating with URL param
🌐 [Rule2→Planets] URL param length: [number]
🧪 [Rule2→Planets] URL encode/decode test for D-1 Set-1: {abcd: [...], bcd: [...]}</pre>
            <p><span class="critical">CRITICAL:</span> The test decode should show the SAME numbers as Rule-2</p>
        </div>

        <div class="step">
            <h3>Step 5: Monitor Planets Analysis Reception</h3>
            <p>After navigation, check Planets Analysis console logs:</p>
            <pre>📡 [PlanetsAnalysis] Received analysis data from URL: {data}
🎯 [D-1 Set-1 SUCCESS] Found numbers: {abcd: [...], bcd: [...]}
🎯 [D-1 Set-1 SUCCESS] ABCD: [correct numbers]
🎯 [D-1 Set-1 SUCCESS] BCD: [correct numbers]</pre>
        </div>

        <div class="step">
            <h3>Step 6: Compare Final Display</h3>
            <p>In Planets Analysis page, look for:</p>
            <div class="data-box">
                Topic Headers showing:<br>
                D-1 Set-1: ABCD Numbers: <span class="critical">[Should be 1,2,4,7,9]</span> / BCD Numbers: <span class="critical">[Should be 5]</span>
            </div>
        </div>
    </div>

    <div class="section warning">
        <h2>🔍 What to Look For</h2>
        
        <h3>✅ If Data Matches Throughout:</h3>
        <ul>
            <li>Rule-2: "1,2,4,7,9/5"</li>
            <li>Console encode test: {abcd: [1,2,4,7,9], bcd: [5]}</li>
            <li>Console decode test: {abcd: [1,2,4,7,9], bcd: [5]}</li>
            <li>Planets display: "1,2,4,7,9/5"</li>
        </ul>
        <p><span class="good">✅ DATA TRANSFER IS WORKING</span></p>

        <h3>❌ If Data Changes:</h3>
        <ul>
            <li>Rule-2 shows: "1,2,4,7,9/5"</li>
            <li>But Planets shows: "1,3/7"</li>
        </ul>
        <p><span class="critical">❌ IDENTIFY WHERE THE CHANGE OCCURS</span></p>
    </div>

    <div class="section info">
        <h2>🛠️ Quick Actions</h2>
        <button onclick="openApp()">🚀 Open Application</button>
        <button onclick="showConsoleHelp()">🔧 Console Help</button>
        <button onclick="copyDebugScript()">📋 Copy Debug Script</button>
    </div>

    <div class="section success">
        <h2>🎯 Expected Resolution</h2>
        <p>After identifying where the data changes, we can:</p>
        <ol>
            <li><strong>If URL encoding fails:</strong> Fix the JSON stringify/parse process</li>
            <li><strong>If URL is too long:</strong> Use navigation state instead of URL params</li>
            <li><strong>If parsing fails:</strong> Add try/catch with fallback logic</li>
            <li><strong>If key mismatch:</strong> Standardize topic naming between pages</li>
        </ol>
    </div>

    <script>
        function openApp() {
            window.open('http://localhost:5173', '_blank');
        }

        function showConsoleHelp() {
            alert(`📋 Console Debug Steps:

1. Open app in new tab
2. Press F12 to open Developer Tools
3. Click "Console" tab
4. Navigate: User → Date → Rule-2 → Planets Analysis
5. Look for 🎯 [Rule2→Planets D-1 Set-1] messages
6. Compare ABCD/BCD numbers at each step
7. Find where the numbers change

Key Messages to Track:
- 🎯 [Rule2→Planets D-1 Set-1] ABCD: [...]
- 🧪 [Rule2→Planets] URL encode/decode test
- 🎯 [D-1 Set-1 SUCCESS] Found numbers: {...}`);
        }

        function copyDebugScript() {
            const script = `// Paste this in browser console to track data
console.log("🔍 Starting data transfer debug...");

// Monitor navigation
const originalNavigate = window.history.pushState;
window.history.pushState = function(...args) {
    console.log("🌐 Navigation detected:", args);
    return originalNavigate.apply(this, args);
};

// Monitor URL parameter parsing
const originalParse = JSON.parse;
JSON.parse = function(str) {
    if (str.includes('analysisData')) {
        console.log("📡 Parsing analysis data:", str.substring(0, 200) + '...');
    }
    return originalParse.call(this, str);
};

console.log("✅ Debug monitoring active - proceed with test");`;

            navigator.clipboard.writeText(script);
            alert('📋 Debug script copied to clipboard!\n\nPaste it in the browser console before testing.');
        }

        // Auto-highlight critical sections
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔍 Debug page loaded - ready to trace Rule-2 → Planets data transfer issue');
        });
    </script>
</body>
</html>
