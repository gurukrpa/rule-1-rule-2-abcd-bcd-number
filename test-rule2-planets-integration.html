<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎯 Rule2 ↔ Planets Integration Test</title>
    <style>
        body { font-family: monospace; line-height: 1.6; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .warning { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        .code { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: 'Courier New', monospace; margin: 10px 0; overflow-x: auto; }
        .highlight { background: #ffeb3b; padding: 2px 4px; font-weight: bold; }
        .step { margin: 15px 0; padding: 10px; border-left: 4px solid #007bff; background: #f8f9fa; }
        .expected { color: #28a745; font-weight: bold; }
        .actual { color: #dc3545; font-weight: bold; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; font-size: 14px; }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .result { margin-top: 10px; padding: 10px; border-radius: 4px; }
        .comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0; }
        .comparison > div { padding: 15px; border-radius: 8px; }
        .rule2-result { background: #e8f5e8; border: 2px solid #4caf50; }
        .planets-result { background: #fff3e0; border: 2px solid #ff9800; }
        .match { background: #c8e6c9; border: 2px solid #4caf50; }
        .mismatch { background: #ffcdd2; border: 2px solid #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 Rule2 ↔ Planets Integration Test</h1>
        <p><strong>Purpose:</strong> Verify that PlanetsAnalysisPage displays real Rule2 calculated data instead of fallback numbers.</p>
        
        <div class="test-section info">
            <h2>📋 Expected Results</h2>
            <div class="comparison">
                <div class="rule2-result">
                    <h3>✅ Rule2CompactPage (Correct)</h3>
                    <div class="expected">D-1 Set-1 Matrix:</div>
                    <div>ABCD: [1, 2, 4, 7, 9]</div>
                    <div>BCD: [5]</div>
                    <small>This is the real calculated data from Rule2 analysis</small>
                </div>
                <div class="planets-result">
                    <h3>❌ PlanetsAnalysisPage (Current Issue)</h3>
                    <div class="actual">D-1 Set-1 Matrix:</div>
                    <div>ABCD: [10, 12] ← Fallback</div>
                    <div>BCD: [4, 11] ← Fallback</div>
                    <small>Should match Rule2 data after our fix</small>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>🔧 Manual Test Steps</h2>
            <div class="step">
                <strong>Step 1:</strong> Navigate to Rule2CompactPage
                <button onclick="navigateToRule2()">🎯 Open Rule2CompactPage</button>
                <div class="code">
                    URL: http://localhost:5173/rule2-compact-page/{userId}
                    Action: Run analysis and note D-1 Set-1 Matrix ABCD/BCD numbers
                </div>
            </div>

            <div class="step">
                <strong>Step 2:</strong> Navigate to PlanetsAnalysisPage  
                <button onclick="navigateToPlanets()">🪐 Open PlanetsAnalysisPage</button>
                <div class="code">
                    URL: http://localhost:5173/planets-analysis/{userId}
                    Action: Check if it shows same D-1 Set-1 numbers as Rule2
                </div>
            </div>

            <div class="step">
                <strong>Step 3:</strong> Test Real Data Integration
                <button onclick="testRealDataIntegration()">🎯 Test Rule2 Integration</button>
                <div class="code">
                    Action: Click "🎯 Refresh Rule2 Analysis" button
                    Expected: Status changes to "🎯 REAL ANALYSIS ACTIVE"
                    Expected: D-1 Set-1 shows ABCD: [1,2,4,7,9], BCD: [5]
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>🧪 Automated Browser Console Tests</h2>
            <button onclick="runBrowserTests()" id="testBtn">🚀 Run All Tests</button>
            <button onclick="clearResults()">🧹 Clear Results</button>
            
            <div id="testResults"></div>
        </div>

        <div class="test-section">
            <h2>📊 Integration Status</h2>
            <div id="integrationStatus" class="warning">
                <strong>Status:</strong> Testing in progress...
                <br><strong>Last Check:</strong> <span id="lastCheck">Not tested yet</span>
            </div>
        </div>

        <div class="test-section">
            <h2>🔍 Console Commands for Manual Testing</h2>
            <div class="code">
// Test if PlanetsAnalysisDataService can get real Rule2 data
const testUserId = 'your-user-id';
const testDates = ['2024-12-28', '2024-12-29', '2024-12-30', '2024-12-31'];

// Import the service (in browser console)
import('./src/services/planetsAnalysisDataService.js').then(module => {
    const { PlanetsAnalysisDataService } = module;
    
    // Test getting latest analysis
    PlanetsAnalysisDataService.getLatestAnalysisNumbers(testUserId, testDates, 1)
        .then(result => {
            console.log('✅ Analysis Result:', result);
            if (result.success) {
                const d1set1 = result.data.topicNumbers['D-1 Set-1 Matrix'];
                console.log('🎯 D-1 Set-1 Matrix:', d1set1);
                console.log('Expected: ABCD [1,2,4,7,9], BCD [5]');
                console.log('Actual:', `ABCD [${d1set1.abcd.join(',')}], BCD [${d1set1.bcd.join(',')}]`);
            }
        })
        .catch(err => console.error('❌ Test failed:', err));
});
            </div>
        </div>

        <div class="test-section">
            <h2>🎯 Fix Verification Checklist</h2>
            <div class="step">
                <input type="checkbox" id="check1"> Rule2CompactPage shows correct data: ABCD [1,2,4,7,9], BCD [5]
            </div>
            <div class="step">
                <input type="checkbox" id="check2"> PlanetsAnalysisPage has "🎯 Refresh Rule2 Analysis" button
            </div>
            <div class="step">
                <input type="checkbox" id="check3"> Clicking refresh button loads real analysis data
            </div>
            <div class="step">
                <input type="checkbox" id="check4"> Status shows "🎯 REAL ANALYSIS ACTIVE" when using real data
            </div>
            <div class="step">
                <input type="checkbox" id="check5"> D-1 Set-1 Matrix verification box shows correct numbers
            </div>
            <div class="step">
                <input type="checkbox" id="check6"> ABCD/BCD badges in planet grid show real numbers
            </div>
            <div class="step">
                <input type="checkbox" id="check7"> Console logs show "Using REAL ANALYSIS numbers" for topics
            </div>
        </div>
    </div>

    <script>
        function navigateToRule2() {
            const userId = prompt('Enter User ID (e.g., demo-user-2025):') || 'demo-user-2025';
            window.open(`http://localhost:5173/rule2-compact-page/${userId}`, '_blank');
        }

        function navigateToPlanets() {
            const userId = prompt('Enter User ID (e.g., demo-user-2025):') || 'demo-user-2025';
            window.open(`http://localhost:5173/planets-analysis/${userId}`, '_blank');
        }

        function testRealDataIntegration() {
            alert('🎯 Test Steps:\n\n1. Open PlanetsAnalysisPage\n2. Click "🎯 Refresh Rule2 Analysis"\n3. Check status changes to "REAL ANALYSIS ACTIVE"\n4. Verify D-1 Set-1 shows ABCD [1,2,4,7,9], BCD [5]\n5. Check console for "Using REAL ANALYSIS numbers" logs');
        }

        function runBrowserTests() {
            const btn = document.getElementById('testBtn');
            btn.disabled = true;
            btn.textContent = '🔄 Testing...';
            
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<div class="info"><strong>Running automated tests...</strong></div>';
            
            // Simulate test results (replace with actual tests)
            setTimeout(() => {
                resultsDiv.innerHTML = `
                    <div class="test-section">
                        <h3>📋 Test Results</h3>
                        <div class="warning">
                            <strong>⚠️ Manual Testing Required</strong><br>
                            These tests require manual verification in the browser:
                            <ul>
                                <li>Navigate to Rule2CompactPage and run analysis</li>
                                <li>Navigate to PlanetsAnalysisPage and test integration</li>
                                <li>Compare D-1 Set-1 Matrix numbers between pages</li>
                                <li>Verify status indicators and console logs</li>
                            </ul>
                        </div>
                        <div class="info">
                            <strong>📊 Integration Status:</strong> Ready for manual testing<br>
                            <strong>Expected:</strong> Real Rule2 data replaces fallback numbers<br>
                            <strong>Key Test:</strong> D-1 Set-1 Matrix should show ABCD [1,2,4,7,9], BCD [5]
                        </div>
                    </div>
                `;
                
                document.getElementById('integrationStatus').className = 'test-section info';
                document.getElementById('integrationStatus').innerHTML = `
                    <strong>Status:</strong> ✅ Ready for manual testing<br>
                    <strong>Last Check:</strong> ${new Date().toLocaleString()}
                `;
                
                btn.disabled = false;
                btn.textContent = '🚀 Run All Tests';
            }, 2000);
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('integrationStatus').className = 'test-section warning';
            document.getElementById('integrationStatus').innerHTML = `
                <strong>Status:</strong> Testing in progress...<br>
                <strong>Last Check:</strong> <span id="lastCheck">Not tested yet</span>
            `;
        }

        // Auto-refresh status
        setInterval(() => {
            const status = document.getElementById('lastCheck');
            if (status && status.textContent === 'Not tested yet') {
                // Keep updating timestamp to show page is active
                document.querySelector('.container h1').style.color = `hsl(${Date.now() % 360}, 70%, 50%)`;
            }
        }, 1000);

        console.log('🎯 Rule2 ↔ Planets Integration Test loaded');
        console.log('📋 Use the buttons above to test the integration');
        console.log('🔧 Expected: PlanetsAnalysisPage shows real Rule2 data instead of fallback');
    </script>
</body>
</html>
