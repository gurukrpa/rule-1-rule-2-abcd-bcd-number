<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Planets Analysis - ABCD/BCD Numbers</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow: auto; }
        button { padding: 8px 16px; margin: 5px; border: none; border-radius: 3px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
    </style>
</head>
<body>
    <h1>üî¨ Debug Planets Analysis - ABCD/BCD Numbers</h1>
    <p>This tool checks if dynamic ABCD/BCD numbers are being loaded correctly for the Planets Analysis page.</p>

    <div class="debug-section info">
        <h3>üéØ Current State Check</h3>
        <button class="btn-primary" onclick="checkCurrentState()">Check Browser State</button>
        <button class="btn-success" onclick="testDynamicLoading()">Test Dynamic Loading</button>
        <button class="btn-warning" onclick="checkDatabase()">Check Database</button>
    </div>

    <div id="results"></div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `debug-section ${type}`;
            div.innerHTML = `
                <h4>[${new Date().toLocaleTimeString()}] ${type.toUpperCase()}</h4>
                <pre>${typeof message === 'object' ? JSON.stringify(message, null, 2) : message}</pre>
            `;
            results.appendChild(div);
        }

        function checkCurrentState() {
            log('üîç Checking current browser state...', 'info');
            
            // Check localStorage
            const selectedUser = localStorage.getItem('selectedUser');
            const activeHR = localStorage.getItem('activeHR');
            
            if (selectedUser) {
                const dates = localStorage.getItem(`dates_${selectedUser}`);
                log(`‚úÖ Found user: ${selectedUser}`, 'success');
                log(`üìÖ Dates: ${dates}`, 'info');
                log(`‚è∞ Active HR: ${activeHR}`, 'info');
                
                if (dates) {
                    const datesList = JSON.parse(dates);
                    const latestDate = datesList.sort((a, b) => new Date(a) - new Date(b))[datesList.length - 1];
                    log(`üìä Latest date: ${latestDate}`, 'info');
                }
            } else {
                log('‚ùå No selected user found in localStorage', 'error');
            }

            // Check if we're on the right page
            log(`üåê Current URL: ${window.location.href}`, 'info');
        }

        async function testDynamicLoading() {
            log('üß™ Testing dynamic ABCD/BCD loading...', 'info');
            
            const selectedUser = localStorage.getItem('selectedUser');
            if (!selectedUser) {
                log('‚ùå No user selected. Please select a user first.', 'error');
                return;
            }

            const dates = localStorage.getItem(`dates_${selectedUser}`);
            if (!dates) {
                log('‚ùå No dates found for user. Please load dates first.', 'error');
                return;
            }

            const datesList = JSON.parse(dates);
            const activeHR = parseInt(localStorage.getItem('activeHR') || '1');

            log(`üéØ Testing with user: ${selectedUser}`, 'info');
            log(`üìÖ Available dates: ${datesList.length}`, 'info');
            log(`‚è∞ Active HR: ${activeHR}`, 'info');

            // Simulate the service call
            try {
                // We'll need to simulate this since we can't import the service here
                log('‚ö†Ô∏è Note: This would call PlanetsAnalysisDataService.getLatestAnalysisNumbers()', 'info');
                log('üîç Expected to find:', 'info');
                log('- ABCD numbers: [10, 12]', 'info');
                log('- BCD numbers: [4, 11]', 'info');
                log('- For date: 2025-06-30', 'info');
                
                // Check what the component would see
                const expectedAnalysisData = {
                    success: true,
                    data: {
                        source: 'rule2',
                        analysisDate: '2025-06-30',
                        topicNumbers: {
                            'D-1 Set-1 Matrix': { abcd: [10, 12], bcd: [4, 11] },
                            'D-1 Set-2 Matrix': { abcd: [10, 12], bcd: [4, 11] }
                        }
                    }
                };
                
                log('‚úÖ Expected analysis structure:', 'success');
                log(expectedAnalysisData, 'success');
                
            } catch (error) {
                log(`‚ùå Error during test: ${error.message}`, 'error');
            }
        }

        async function checkDatabase() {
            log('üóÑÔ∏è Checking database state...', 'info');
            
            // Check if we can access any analysis data
            const selectedUser = localStorage.getItem('selectedUser');
            if (!selectedUser) {
                log('‚ùå No user selected', 'error');
                return;
            }

            log('üîç Looking for stored analysis results...', 'info');
            
            // Check for any stored analysis results in localStorage
            const keys = Object.keys(localStorage).filter(key => 
                key.includes(selectedUser) && 
                (key.includes('analysis') || key.includes('rule2') || key.includes('results'))
            );
            
            if (keys.length > 0) {
                log(`‚úÖ Found ${keys.length} analysis-related keys:`, 'success');
                keys.forEach(key => {
                    log(`- ${key}`, 'info');
                });
            } else {
                log('‚ùå No analysis results found in localStorage', 'error');
            }

            // Check what the current Planets Analysis page would show
            log('üìä Current hardcoded fallback values:', 'info');
            log('- PlanetsAnalysisPageSimple.jsx: [6, 8, 11] and [9, 10]', 'info');
            log('- Expected dynamic values: [10, 12] and [4, 11]', 'info');
        }

        // Run initial check
        checkCurrentState();
    </script>
</body>
</html>
