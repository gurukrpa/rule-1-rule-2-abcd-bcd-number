<!DOCTYPE html>
<html>
<head>
    <title>Create Test Data for Planets Analysis</title>
</head>
<body>
    <h1>Create Test Data for Planets Analysis</h1>
    <button onclick="createTestData()">Create Test Data</button>
    <div id="output"></div>

    <script type="module">
        import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js';
        
        const supabaseUrl = 'https://zndkprjytuhzufdqhnmt.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpuZGtwcmp5dHVoenVmZHFobm10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ5NzU2NDMsImV4cCI6MjA1MDU1MTY0M30.tYHEJqX_-J7CKMJXIlGKTKJ5bVMRcm1n6kPh-I_BJ50';
        
        const supabase = createClient(supabaseUrl, supabaseKey);
        
        window.createTestData = async function() {
            const output = document.getElementById('output');
            output.innerHTML = '<p>Creating test data...</p>';
            
            const userId = '8db9861a-76ce-4ae3-81b0-7a8b82314ef2';
            const testDate = '2025-06-06';
            
            try {
                // 1. Create user if not exists
                output.innerHTML += '<p>1. Creating user...</p>';
                const { data: existingUser } = await supabase
                    .from('users')
                    .select('*')
                    .eq('id', userId)
                    .single();
                
                if (!existingUser) {
                    const { error: userError } = await supabase
                        .from('users')
                        .insert({
                            id: userId,
                            username: 'TestUser',
                            hr: 24,
                            name: 'Test User for Planets Analysis'
                        });
                    
                    if (userError) {
                        output.innerHTML += `<p style="color: red;">‚ùå User creation failed: ${userError.message}</p>`;
                        return;
                    }
                    output.innerHTML += '<p style="color: green;">‚úÖ User created</p>';
                } else {
                    output.innerHTML += '<p style="color: green;">‚úÖ User already exists</p>';
                }
                
                // 2. Add date to user_dates
                output.innerHTML += '<p>2. Adding date to user_dates...</p>';
                const { error: datesError } = await supabase
                    .from('user_dates')
                    .upsert({
                        user_id: userId,
                        dates: [testDate],
                        updated_at: new Date().toISOString()
                    }, { onConflict: 'user_id' });
                
                if (datesError) {
                    output.innerHTML += `<p style="color: red;">‚ùå Dates creation failed: ${datesError.message}</p>`;
                    return;
                }
                output.innerHTML += '<p style="color: green;">‚úÖ Date added to user_dates</p>';
                
                // 3. Create hour entry
                output.innerHTML += '<p>3. Creating hour entry...</p>';
                const planetSelections = {};
                const planets = ['Su', 'Mo', 'Ma', 'Me', 'Ju', 'Ve', 'Sa', 'Ra', 'Ke'];
                for (let hr = 1; hr <= 24; hr++) {
                    planetSelections[hr] = planets[hr % planets.length];
                }
                
                const { error: hourError } = await supabase
                    .from('hour_entries')
                    .upsert({
                        user_id: userId,
                        date_key: testDate,
                        hour_data: {
                            planetSelections: planetSelections,
                            savedAt: new Date().toISOString()
                        }
                    }, { onConflict: 'user_id,date_key' });
                
                if (hourError) {
                    output.innerHTML += `<p style="color: red;">‚ùå Hour entry creation failed: ${hourError.message}</p>`;
                    return;
                }
                output.innerHTML += '<p style="color: green;">‚úÖ Hour entry created</p>';
                
                // 4. Create simple Excel data
                output.innerHTML += '<p>4. Creating Excel data...</p>';
                const testExcelData = {
                    sets: {
                        'D-1 Set-1 Matrix': {
                            'Lagna': {
                                'Su': 'as-1-/su-(12 Ar 50)-(20 Ta 50)',
                                'Mo': 'as-2-/mo-(15 Ta 30)-(25 Ge 30)',
                                'Ma': 'as-3-/ma-(18 Ge 20)-(28 Ca 20)'
                            },
                            'Moon': {
                                'Su': 'mo-4-/su-(22 Ca 10)-(02 Le 10)',
                                'Mo': 'mo-5-/mo-(25 Le 00)-(05 Vi 00)',
                                'Ma': 'mo-6-/ma-(28 Vi 50)-(08 Li 50)'
                            }
                        },
                        'D-1 Set-2 Matrix': {
                            'Lagna': {
                                'Su': 'as-7-/su-(01 Li 40)-(11 Sc 40)',
                                'Mo': 'as-8-/mo-(04 Sc 30)-(14 Sa 30)',
                                'Ma': 'as-9-/ma-(07 Sa 20)-(17 Cp 20)'
                            }
                        }
                    }
                };
                
                const { error: excelError } = await supabase
                    .from('excel_data')
                    .upsert({
                        user_id: userId,
                        date: testDate,
                        file_name: 'test-planets.xlsx',
                        data: testExcelData,
                        uploaded_at: new Date().toISOString()
                    }, { onConflict: 'user_id,date' });
                
                if (excelError) {
                    output.innerHTML += `<p style="color: red;">‚ùå Excel data creation failed: ${excelError.message}</p>`;
                    return;
                }
                output.innerHTML += '<p style="color: green;">‚úÖ Excel data created</p>';
                
                // 5. Verification
                output.innerHTML += '<p>5. Verification...</p>';
                const { data: verifyHour } = await supabase
                    .from('hour_entries')
                    .select('*')
                    .eq('user_id', userId)
                    .eq('date_key', testDate);
                
                const { data: verifyExcel } = await supabase
                    .from('excel_data')
                    .select('*')
                    .eq('user_id', userId)
                    .eq('date', testDate);
                
                output.innerHTML += `<p style="color: green;">‚úÖ Verification complete!</p>`;
                output.innerHTML += `<p>Hour entries: ${verifyHour?.length || 0}</p>`;
                output.innerHTML += `<p>Excel entries: ${verifyExcel?.length || 0}</p>`;
                output.innerHTML += `<p><strong>üéâ Test data created successfully!</strong></p>`;
                output.innerHTML += `<p><strong>Now refresh your PlanetsAnalysisPage to test!</strong></p>`;
                
            } catch (error) {
                output.innerHTML += `<p style="color: red;">üí• Error: ${error.message}</p>`;
                console.error('Error creating test data:', error);
            }
        };
    </script>
</body>
</html>
